#!/usr/bin/env bash

set -eu

shellyBin=$(dirname $0)
PATH=${shellyBin}:${PATH}

fromDir=$(RealPath $(dirname $0)/../dotfiles)

if [[ ! -f $fromDir/.bashrc ]]; then
  echo Cannot find $fromDir/.bashrc
  exit 1
fi

for file in ${fromDir}/.[a-z]*; do
  basefile=$(basename $file)
  if [[ -w ~/$basefile ]]; then
    if [[ -L ~/$basefile ]]; then
      echo ${basefile} already a link to $(readlink ~/${basefile})
    else
      echo Moving existing ${basefile} to ${basefile}.old
      mv -i ~/${basefile} ~/${basefile}.old
      ln -s $file ~
    fi
  else
    echo Linking ~/${basefile}
    ln -s $file ~
  fi
done
