#!/bin/bash -ue

${DEBUG:-}

if [[ $# -lt 1 ]]; then
  echo "usage: $(basename $0) cabal-package-name [args to cabal install]" >&2
  exit 2
fi

pkg=${1}; shift

function bail() {
set -x
  msg=$1
  echo "${msg}" >&2
  exit 1
}

dir=~/.shelly/cabal-sandboxes/${pkg}

if [[ -d ${dir} ]]; then
  bail "Package ${pkg} seems to be installed already. ${dir} exists."
fi

mkdir -p ${dir}
cd ${dir}
cabal sandbox init
cabal install "$@" ${pkg}
