# vim: set filetype=bash:
# shellcheck shell=bash

is_apple_dark() {
  defaults read -globalDomain AppleInterfaceStyle &> /dev/null == 'Dark'
}

is_dark_mode() {
  [[ $ITERM_PROFILE == 'Dark' ]]
}

function set_iterm_profile {
  profile="$1"
  echo -e "\033]1337;SetProfile=$profile\a"
  ITERM_PROFILE="$profile"
  export ITERM_PROFILE
}

function apple_adapt_mode {
  if hash -is_apple_dark; then
    profile="Dark"
  else
    profile="Light"
  fi

  set_iterm_profile "$profile"
}

if [[ $SHELLY_OS == 'darwin' ]]; then
  precmd_functions+=(apple_adapt_mode)
fi
